
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Troubleshooting &#8212; Himalaya 0.4.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="_static/gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="_static/gallery-rendered-html.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Gallery of examples" href="_auto_examples/index.html" />
    <link rel="prev" title="Model flowchart" href="flowchart.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/logo.svg" alt="Logo"/>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=gallantlab&repo=himalaya&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="flowchart.html" title="previous chapter">Model flowchart</a></li>
      <li>Next: <a href="_auto_examples/index.html" title="next chapter">Gallery of examples</a></li>
  </ul></li>
</ul>
</div><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">Model descriptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="flowchart.html">Model flowchart</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="_auto_examples/index.html">Gallery of examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="troubleshooting">
<h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h1>
<p>We detail here common issues encountered with <code class="docutils literal notranslate"><span class="pre">himalaya</span></code>, and how to fix
them.</p>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="cuda-out-of-memory">
<h2>CUDA out of memory<a class="headerlink" href="#cuda-out-of-memory" title="Permalink to this headline">¶</a></h2>
<p>The GPU memory is often smaller than the CPU memory, so it requires more
attention to avoid running out of memory. Himalaya implements a series of
options to limit the GPU memory, often at the cost of computational speed:</p>
<ul class="simple">
<li><p>Some solvers implement computations over batches, to limit the size of
intermediate arrays. See for instance <code class="docutils literal notranslate"><span class="pre">n_targets_batch</span></code>, or
<code class="docutils literal notranslate"><span class="pre">n_alphas_batch</span></code> in <a class="reference internal" href="_generated/himalaya.kernel_ridge.KernelRidgeCV.html#himalaya.kernel_ridge.KernelRidgeCV" title="himalaya.kernel_ridge.KernelRidgeCV"><code class="xref py py-class docutils literal notranslate"><span class="pre">KernelRidgeCV</span></code></a>.</p></li>
<li><p>Some solvers implement an option to keep the input kernels or the targets in
CPU memory. See for instance <code class="docutils literal notranslate"><span class="pre">Y_in_cpu</span></code> in
<a class="reference internal" href="_generated/himalaya.kernel_ridge.MultipleKernelRidgeCV.html#himalaya.kernel_ridge.MultipleKernelRidgeCV" title="himalaya.kernel_ridge.MultipleKernelRidgeCV"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipleKernelRidgeCV</span></code></a>.</p></li>
<li><p>Some estimators can also be forced to use CPU, ignoring the current backend,
using the parameter <code class="docutils literal notranslate"><span class="pre">force_cpu=True</span></code>. To limit GPU memory, some estimators
in the same pipeline can use <code class="docutils literal notranslate"><span class="pre">force_cpu=True</span></code> and others
<code class="docutils literal notranslate"><span class="pre">force_cpu=False</span></code>. In particular, it is possible to precompute kernels on
CPU, using <a class="reference internal" href="_generated/himalaya.kernel_ridge.Kernelizer.html#himalaya.kernel_ridge.Kernelizer" title="himalaya.kernel_ridge.Kernelizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Kernelizer</span></code></a> or
<a class="reference internal" href="_generated/himalaya.kernel_ridge.ColumnKernelizer.html#himalaya.kernel_ridge.ColumnKernelizer" title="himalaya.kernel_ridge.ColumnKernelizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnKernelizer</span></code></a> with the parameter
<code class="docutils literal notranslate"><span class="pre">force_cpu=True</span></code> before fitting a
<a class="reference internal" href="_generated/himalaya.kernel_ridge.KernelRidgeCV.html#himalaya.kernel_ridge.KernelRidgeCV" title="himalaya.kernel_ridge.KernelRidgeCV"><code class="xref py py-class docutils literal notranslate"><span class="pre">KernelRidgeCV</span></code></a> or a
<a class="reference internal" href="_generated/himalaya.kernel_ridge.MultipleKernelRidgeCV.html#himalaya.kernel_ridge.MultipleKernelRidgeCV" title="himalaya.kernel_ridge.MultipleKernelRidgeCV"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipleKernelRidgeCV</span></code></a> on GPU.</p></li>
</ul>
<p>A CUDA out of memory issue can also arise with <code class="docutils literal notranslate"><span class="pre">pytorch</span> <span class="pre">&lt;</span> <span class="pre">1.9</span></code>, for example
with <a class="reference internal" href="_generated/himalaya.kernel_ridge.KernelRidge.html#himalaya.kernel_ridge.KernelRidge" title="himalaya.kernel_ridge.KernelRidge"><code class="xref py py-class docutils literal notranslate"><span class="pre">KernelRidge</span></code></a>, where a solver requires
ridiculously high peak memory during a broadcasting matmul operation. This
<a class="reference external" href="https://github.com/pytorch/pytorch/pull/54616">issue</a> can be fixed by
updating to <code class="docutils literal notranslate"><span class="pre">pytorch</span> <span class="pre">=</span> <span class="pre">1.9</span></code> or newer versions.</p>
</div>
<div class="section" id="slow-check-array">
<h2>Slow check_array<a class="headerlink" href="#slow-check-array" title="Permalink to this headline">¶</a></h2>
<p>In himalaya, the scikit-learn compatible estimators validate the input data,
checking the absence of NaN or infinite values. For large datasets, this check
can take significant computational time. To skip this check, simply call
<code class="docutils literal notranslate"><span class="pre">sklearn.set_config(assume_finite=True)</span></code> before fitting your models.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2020, Gallant lab.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/troubleshooting.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>