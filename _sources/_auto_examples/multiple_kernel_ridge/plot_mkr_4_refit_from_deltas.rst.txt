
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "_auto_examples/multiple_kernel_ridge/plot_mkr_4_refit_from_deltas.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download__auto_examples_multiple_kernel_ridge_plot_mkr_4_refit_from_deltas.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr__auto_examples_multiple_kernel_ridge_plot_mkr_4_refit_from_deltas.py:


Multiple-kernel ridge fit from fixed hyper-parameters
=====================================================
This example demonstrates how to fit a multiple-kernel ridge model with fixed
hyper-parameters. Here are three different usecases:

- If the kernel weights hyper-parameters are known and identical across
  targets, the kernels can be scaled and summed, and a simple KernelRidgeCV can
  be used to fit the model.
- If the kernel weights hyper-parameters are unknown and different across
  targets, a MultipleKernelRidgeCV can be use to search the best
  hyper-parameters per target.
- If the kernel weights hyper-parameters are known and different across
  targets, a WeightedKernelRidge model can be used to fit the ridge models on
  each target independently.

This method can be used for example in the following workflow:

- fit a MultipleKernelRidgeCV to learn the kernel weights hyper-parameter,
- save the hyper-parameters, but not the ridge weights to save disk space,
- fit a WeightedKernelRidge from the saved hyper-parameters, for further use of
  the model (prediction, interpretation, etc.).

.. GENERATED FROM PYTHON SOURCE LINES 24-36

.. code-block:: default

    import numpy as np

    from himalaya.backend import set_backend
    from himalaya.kernel_ridge import WeightedKernelRidge
    from himalaya.kernel_ridge import Kernelizer
    from himalaya.kernel_ridge import ColumnKernelizer
    from himalaya.utils import generate_multikernel_dataset

    from sklearn.pipeline import make_pipeline
    from sklearn import set_config
    set_config(display='diagram')








.. GENERATED FROM PYTHON SOURCE LINES 37-38

In this example, we use the ``torch_cuda`` backend (GPU).

.. GENERATED FROM PYTHON SOURCE LINES 38-41

.. code-block:: default


    backend = set_backend("torch_cuda", on_error="warn")





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    /home/runner/work/himalaya/himalaya/himalaya/backend/_utils.py:56: UserWarning: Setting backend to torch_cuda failed: PyTorch with CUDA is not available..Falling back to numpy backend.
      warnings.warn(f"Setting backend to {backend} failed: {str(error)}."




.. GENERATED FROM PYTHON SOURCE LINES 42-48

Generate a random dataset
-------------------------
- X_train : array of shape (n_samples_train, n_features)
- X_test : array of shape (n_samples_test, n_features)
- Y_train : array of shape (n_samples_train, n_targets)
- Y_test : array of shape (n_samples_test, n_targets)

.. GENERATED FROM PYTHON SOURCE LINES 48-55

.. code-block:: default


    (X_train, X_test, Y_train, Y_test, kernel_weights,
     n_features_list) = generate_multikernel_dataset(n_kernels=4, n_targets=500,
                                                     n_samples_train=1000,
                                                     n_samples_test=400,
                                                     random_state=42)








.. GENERATED FROM PYTHON SOURCE LINES 56-58

Prepare the pipeline
--------------------

.. GENERATED FROM PYTHON SOURCE LINES 58-71

.. code-block:: default


    # Find the start and end of each feature space X in Xs
    start_and_end = np.concatenate([[0], np.cumsum(n_features_list)])
    slices = [
        slice(start, end)
        for start, end in zip(start_and_end[:-1], start_and_end[1:])
    ]

    # Create a different ``Kernelizer`` for each feature space.
    kernelizers = [("space %d" % ii, Kernelizer(), slice_)
                   for ii, slice_ in enumerate(slices)]
    column_kernelizer = ColumnKernelizer(kernelizers)








.. GENERATED FROM PYTHON SOURCE LINES 72-76

Define the weighted kernel ridge model
--------------------------------------
Here we use the ground truth kernel weights for each target (deltas), but it
can be typically used with deltas obtained from a MultipleKernelRidgeCV fit.

.. GENERATED FROM PYTHON SOURCE LINES 76-85

.. code-block:: default


    deltas = backend.log(backend.asarray(kernel_weights.T))

    model_1 = WeightedKernelRidge(alpha=1, deltas=deltas, kernels="precomputed")
    pipe_1 = make_pipeline(column_kernelizer, model_1)

    # Fit the model on all targets
    pipe_1.fit(X_train, Y_train)






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <style>#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 {color: black;background-color: white;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 pre{padding: 0;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-toggleable {background-color: white;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-estimator:hover {background-color: #d4ebff;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-item {z-index: 1;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-parallel-item:only-child::after {width: 0;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06 div.sk-text-repr-fallback {display: none;}</style><div id="sk-6b5c77b7-b9f0-4901-941f-cd82b4bafc06" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columnkernelizer&#x27;,
                     ColumnKernelizer(transformers=[(&#x27;space 0&#x27;, Kernelizer(),
                                                     slice(0, 1000, None)),
                                                    (&#x27;space 1&#x27;, Kernelizer(),
                                                     slice(1000, 2000, None)),
                                                    (&#x27;space 2&#x27;, Kernelizer(),
                                                     slice(2000, 3000, None)),
                                                    (&#x27;space 3&#x27;, Kernelizer(),
                                                     slice(3000, 4000, None))])),
                    (&#x27;weightedkernelridge&#x27;,
                     WeightedKernelRidge(alpha=1,
                                         deltas=array([[ -2.34827793,  -1.50641419,  -2.19109293, ...,  -0.54280854,
             -1.91624718,  -4.46468491],
           [ -0.10634121, -12.75390818,  -1.02284602, ...,  -1.07414928,
             -0.74925702, -11.53405081],
           [ -5.26735604,  -0.25595749,  -2.32634355, ...,  -6.47051769,
             -5.09014343,  -0.03591909],
           [ -8.5609958 ,  -5.49222012,  -0.84168615, ...,  -2.58032377,
             -0.98358763,  -3.73960252]]),
                                         kernels=&#x27;precomputed&#x27;))])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6b159389-1a78-462d-8e47-19e4307507d9" type="checkbox" ><label for="6b159389-1a78-462d-8e47-19e4307507d9" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;columnkernelizer&#x27;,
                     ColumnKernelizer(transformers=[(&#x27;space 0&#x27;, Kernelizer(),
                                                     slice(0, 1000, None)),
                                                    (&#x27;space 1&#x27;, Kernelizer(),
                                                     slice(1000, 2000, None)),
                                                    (&#x27;space 2&#x27;, Kernelizer(),
                                                     slice(2000, 3000, None)),
                                                    (&#x27;space 3&#x27;, Kernelizer(),
                                                     slice(3000, 4000, None))])),
                    (&#x27;weightedkernelridge&#x27;,
                     WeightedKernelRidge(alpha=1,
                                         deltas=array([[ -2.34827793,  -1.50641419,  -2.19109293, ...,  -0.54280854,
             -1.91624718,  -4.46468491],
           [ -0.10634121, -12.75390818,  -1.02284602, ...,  -1.07414928,
             -0.74925702, -11.53405081],
           [ -5.26735604,  -0.25595749,  -2.32634355, ...,  -6.47051769,
             -5.09014343,  -0.03591909],
           [ -8.5609958 ,  -5.49222012,  -0.84168615, ...,  -2.58032377,
             -0.98358763,  -3.73960252]]),
                                         kernels=&#x27;precomputed&#x27;))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ac3191c2-1626-4d79-bf86-22d850ade82b" type="checkbox" ><label for="ac3191c2-1626-4d79-bf86-22d850ade82b" class="sk-toggleable__label sk-toggleable__label-arrow">columnkernelizer: ColumnKernelizer</label><div class="sk-toggleable__content"><pre>ColumnKernelizer(transformers=[(&#x27;space 0&#x27;, Kernelizer(), slice(0, 1000, None)),
                                   (&#x27;space 1&#x27;, Kernelizer(),
                                    slice(1000, 2000, None)),
                                   (&#x27;space 2&#x27;, Kernelizer(),
                                    slice(2000, 3000, None)),
                                   (&#x27;space 3&#x27;, Kernelizer(),
                                    slice(3000, 4000, None))])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ade9c4b2-1eb5-4cc1-9d1a-d0c2100fbee5" type="checkbox" ><label for="ade9c4b2-1eb5-4cc1-9d1a-d0c2100fbee5" class="sk-toggleable__label sk-toggleable__label-arrow">space 0</label><div class="sk-toggleable__content"><pre>slice(0, 1000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d08fc56b-17e6-40c2-b005-57dee04f8449" type="checkbox" ><label for="d08fc56b-17e6-40c2-b005-57dee04f8449" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4c49d843-389b-4321-989f-d0387b8079a9" type="checkbox" ><label for="4c49d843-389b-4321-989f-d0387b8079a9" class="sk-toggleable__label sk-toggleable__label-arrow">space 1</label><div class="sk-toggleable__content"><pre>slice(1000, 2000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b15c263c-abd5-4505-a21c-630fbcdbc1df" type="checkbox" ><label for="b15c263c-abd5-4505-a21c-630fbcdbc1df" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a762e6f8-e148-43d6-97ac-617a315f3b34" type="checkbox" ><label for="a762e6f8-e148-43d6-97ac-617a315f3b34" class="sk-toggleable__label sk-toggleable__label-arrow">space 2</label><div class="sk-toggleable__content"><pre>slice(2000, 3000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a6e2c673-4b02-4006-b6b1-07ea71372020" type="checkbox" ><label for="a6e2c673-4b02-4006-b6b1-07ea71372020" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9dacf71c-6b07-4277-ab14-b782d5aff14f" type="checkbox" ><label for="9dacf71c-6b07-4277-ab14-b782d5aff14f" class="sk-toggleable__label sk-toggleable__label-arrow">space 3</label><div class="sk-toggleable__content"><pre>slice(3000, 4000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="dbd80909-64ae-4f9f-9daf-fcc75656ad5d" type="checkbox" ><label for="dbd80909-64ae-4f9f-9daf-fcc75656ad5d" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="612a038d-d0fc-40c6-97ac-b2232d4d0d87" type="checkbox" ><label for="612a038d-d0fc-40c6-97ac-b2232d4d0d87" class="sk-toggleable__label sk-toggleable__label-arrow">WeightedKernelRidge</label><div class="sk-toggleable__content"><pre>WeightedKernelRidge(alpha=1,
                        deltas=array([[ -2.34827793,  -1.50641419,  -2.19109293, ...,  -0.54280854,
             -1.91624718,  -4.46468491],
           [ -0.10634121, -12.75390818,  -1.02284602, ...,  -1.07414928,
             -0.74925702, -11.53405081],
           [ -5.26735604,  -0.25595749,  -2.32634355, ...,  -6.47051769,
             -5.09014343,  -0.03591909],
           [ -8.5609958 ,  -5.49222012,  -0.84168615, ...,  -2.58032377,
             -0.98358763,  -3.73960252]]),
                        kernels=&#x27;precomputed&#x27;)</pre></div></div></div></div></div></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 86-87

compute test score

.. GENERATED FROM PYTHON SOURCE LINES 87-90

.. code-block:: default

    test_scores_1 = pipe_1.score(X_test, Y_test)
    test_scores_1 = backend.to_numpy(test_scores_1)








.. GENERATED FROM PYTHON SOURCE LINES 91-93

We can compare this model to a baseline model where the kernel weights are
all equal and not learnt.

.. GENERATED FROM PYTHON SOURCE LINES 93-100

.. code-block:: default


    model_2 = WeightedKernelRidge(alpha=1, deltas="zeros", kernels="precomputed")
    pipe_2 = make_pipeline(column_kernelizer, model_2)

    # Fit the model on all targets
    pipe_2.fit(X_train, Y_train)






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <style>#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc {color: black;background-color: white;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc pre{padding: 0;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-toggleable {background-color: white;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-estimator:hover {background-color: #d4ebff;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-item {z-index: 1;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-parallel-item:only-child::after {width: 0;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc div.sk-text-repr-fallback {display: none;}</style><div id="sk-89c1b951-97f1-49c0-8964-3d4ef2f517bc" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columnkernelizer&#x27;,
                     ColumnKernelizer(transformers=[(&#x27;space 0&#x27;, Kernelizer(),
                                                     slice(0, 1000, None)),
                                                    (&#x27;space 1&#x27;, Kernelizer(),
                                                     slice(1000, 2000, None)),
                                                    (&#x27;space 2&#x27;, Kernelizer(),
                                                     slice(2000, 3000, None)),
                                                    (&#x27;space 3&#x27;, Kernelizer(),
                                                     slice(3000, 4000, None))])),
                    (&#x27;weightedkernelridge&#x27;,
                     WeightedKernelRidge(alpha=1, kernels=&#x27;precomputed&#x27;))])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6b172c10-bd52-49ca-b577-9442e00b7fd0" type="checkbox" ><label for="6b172c10-bd52-49ca-b577-9442e00b7fd0" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;columnkernelizer&#x27;,
                     ColumnKernelizer(transformers=[(&#x27;space 0&#x27;, Kernelizer(),
                                                     slice(0, 1000, None)),
                                                    (&#x27;space 1&#x27;, Kernelizer(),
                                                     slice(1000, 2000, None)),
                                                    (&#x27;space 2&#x27;, Kernelizer(),
                                                     slice(2000, 3000, None)),
                                                    (&#x27;space 3&#x27;, Kernelizer(),
                                                     slice(3000, 4000, None))])),
                    (&#x27;weightedkernelridge&#x27;,
                     WeightedKernelRidge(alpha=1, kernels=&#x27;precomputed&#x27;))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c7847a1c-896e-454d-a32c-e54204b3605c" type="checkbox" ><label for="c7847a1c-896e-454d-a32c-e54204b3605c" class="sk-toggleable__label sk-toggleable__label-arrow">columnkernelizer: ColumnKernelizer</label><div class="sk-toggleable__content"><pre>ColumnKernelizer(transformers=[(&#x27;space 0&#x27;, Kernelizer(), slice(0, 1000, None)),
                                   (&#x27;space 1&#x27;, Kernelizer(),
                                    slice(1000, 2000, None)),
                                   (&#x27;space 2&#x27;, Kernelizer(),
                                    slice(2000, 3000, None)),
                                   (&#x27;space 3&#x27;, Kernelizer(),
                                    slice(3000, 4000, None))])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="83152ed5-dba0-491a-9c4c-6bb1fbfefb29" type="checkbox" ><label for="83152ed5-dba0-491a-9c4c-6bb1fbfefb29" class="sk-toggleable__label sk-toggleable__label-arrow">space 0</label><div class="sk-toggleable__content"><pre>slice(0, 1000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="1cd24988-b186-46ee-89bc-8ac979e9cffb" type="checkbox" ><label for="1cd24988-b186-46ee-89bc-8ac979e9cffb" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="49ba7fc5-c9d5-45d2-abdc-430f4daf7cab" type="checkbox" ><label for="49ba7fc5-c9d5-45d2-abdc-430f4daf7cab" class="sk-toggleable__label sk-toggleable__label-arrow">space 1</label><div class="sk-toggleable__content"><pre>slice(1000, 2000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="98e37c3e-c576-4961-8c53-ad6487033cb8" type="checkbox" ><label for="98e37c3e-c576-4961-8c53-ad6487033cb8" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c24cf4e0-4b3b-4571-b89b-9fecebd902df" type="checkbox" ><label for="c24cf4e0-4b3b-4571-b89b-9fecebd902df" class="sk-toggleable__label sk-toggleable__label-arrow">space 2</label><div class="sk-toggleable__content"><pre>slice(2000, 3000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ab3bcd34-1dc3-46f9-9f55-f409ab1c415a" type="checkbox" ><label for="ab3bcd34-1dc3-46f9-9f55-f409ab1c415a" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="678b9863-b33a-4423-adbe-5a71699fa56e" type="checkbox" ><label for="678b9863-b33a-4423-adbe-5a71699fa56e" class="sk-toggleable__label sk-toggleable__label-arrow">space 3</label><div class="sk-toggleable__content"><pre>slice(3000, 4000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8375c186-fd25-4b26-adf6-6d4c5ce3c69a" type="checkbox" ><label for="8375c186-fd25-4b26-adf6-6d4c5ce3c69a" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="1a6f044c-adc3-4f14-9f12-8cfca9e62594" type="checkbox" ><label for="1a6f044c-adc3-4f14-9f12-8cfca9e62594" class="sk-toggleable__label sk-toggleable__label-arrow">WeightedKernelRidge</label><div class="sk-toggleable__content"><pre>WeightedKernelRidge(alpha=1, kernels=&#x27;precomputed&#x27;)</pre></div></div></div></div></div></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 101-102

compute test score

.. GENERATED FROM PYTHON SOURCE LINES 102-105

.. code-block:: default

    test_scores_2 = pipe_2.score(X_test, Y_test)
    test_scores_2 = backend.to_numpy(test_scores_2)








.. GENERATED FROM PYTHON SOURCE LINES 106-108

Compare the predictions on a test set
-------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 108-120

.. code-block:: default

    import matplotlib.pyplot as plt

    plt.figure(figsize=(4, 3))
    plt.hist(test_scores_2, np.linspace(0, 1, 30), alpha=0.7,
             label="Default deltas")
    plt.hist(test_scores_1, np.linspace(0, 1, 30), alpha=0.7,
             label="Ground truth deltas")
    plt.xlabel("$R^2$ generalization score")
    plt.ylabel("Number of voxels")
    plt.legend()
    plt.tight_layout()
    plt.show()



.. image-sg:: /_auto_examples/multiple_kernel_ridge/images/sphx_glr_plot_mkr_4_refit_from_deltas_001.png
   :alt: plot mkr 4 refit from deltas
   :srcset: /_auto_examples/multiple_kernel_ridge/images/sphx_glr_plot_mkr_4_refit_from_deltas_001.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  3.353 seconds)


.. _sphx_glr_download__auto_examples_multiple_kernel_ridge_plot_mkr_4_refit_from_deltas.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_mkr_4_refit_from_deltas.py <plot_mkr_4_refit_from_deltas.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_mkr_4_refit_from_deltas.ipynb <plot_mkr_4_refit_from_deltas.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
