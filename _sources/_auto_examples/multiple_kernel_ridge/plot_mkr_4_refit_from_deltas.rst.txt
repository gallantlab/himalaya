
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "_auto_examples/multiple_kernel_ridge/plot_mkr_4_refit_from_deltas.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download__auto_examples_multiple_kernel_ridge_plot_mkr_4_refit_from_deltas.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr__auto_examples_multiple_kernel_ridge_plot_mkr_4_refit_from_deltas.py:


Multiple-kernel ridge fit from fixed hyper-parameters
=====================================================
This example demonstrates how to fit a multiple-kernel ridge model with fixed
hyper-parameters. Here are three different usecases:

- If the kernel weights hyper-parameters are known and identical across
  targets, the kernels can be scaled and summed, and a simple KernelRidgeCV can
  be used to fit the model.
- If the kernel weights hyper-parameters are unknown and different across
  targets, a MultipleKernelRidgeCV can be use to search the best
  hyper-parameters per target.
- If the kernel weights hyper-parameters are known and different across
  targets, a WeightedKernelRidge model can be used to fit the ridge models on
  each target independently.

This method can be used for example in the following workflow:

- fit a MultipleKernelRidgeCV to learn the kernel weights hyper-parameter,
- save the hyper-parameters, but not the ridge weights to save disk space,
- fit a WeightedKernelRidge from the saved hyper-parameters, for further use of
  the model (prediction, interpretation, etc.).

.. GENERATED FROM PYTHON SOURCE LINES 24-36

.. code-block:: default

    import numpy as np

    from himalaya.backend import set_backend
    from himalaya.kernel_ridge import WeightedKernelRidge
    from himalaya.kernel_ridge import Kernelizer
    from himalaya.kernel_ridge import ColumnKernelizer
    from himalaya.utils import generate_multikernel_dataset

    from sklearn.pipeline import make_pipeline
    from sklearn import set_config
    set_config(display='diagram')








.. GENERATED FROM PYTHON SOURCE LINES 37-38

In this example, we use the ``torch_cuda`` backend (GPU).

.. GENERATED FROM PYTHON SOURCE LINES 38-41

.. code-block:: default


    backend = set_backend("torch_cuda", on_error="warn")








.. GENERATED FROM PYTHON SOURCE LINES 42-48

Generate a random dataset
-------------------------
- X_train : array of shape (n_samples_train, n_features)
- X_test : array of shape (n_samples_test, n_features)
- Y_train : array of shape (n_samples_train, n_targets)
- Y_test : array of shape (n_samples_test, n_targets)

.. GENERATED FROM PYTHON SOURCE LINES 48-55

.. code-block:: default


    (X_train, X_test, Y_train, Y_test, kernel_weights,
     n_features_list) = generate_multikernel_dataset(n_kernels=4, n_targets=500,
                                                     n_samples_train=1000,
                                                     n_samples_test=400,
                                                     random_state=42)








.. GENERATED FROM PYTHON SOURCE LINES 56-58

Prepare the pipeline
--------------------

.. GENERATED FROM PYTHON SOURCE LINES 58-71

.. code-block:: default


    # Find the start and end of each feature space X in Xs
    start_and_end = np.concatenate([[0], np.cumsum(n_features_list)])
    slices = [
        slice(start, end)
        for start, end in zip(start_and_end[:-1], start_and_end[1:])
    ]

    # Create a different ``Kernelizer`` for each feature space.
    kernelizers = [("space %d" % ii, Kernelizer(), slice_)
                   for ii, slice_ in enumerate(slices)]
    column_kernelizer = ColumnKernelizer(kernelizers)








.. GENERATED FROM PYTHON SOURCE LINES 72-76

Define the weighted kernel ridge model
--------------------------------------
Here we use the ground truth kernel weights for each target (deltas), but it
can be typically used with deltas obtained from a MultipleKernelRidgeCV fit.

.. GENERATED FROM PYTHON SOURCE LINES 76-85

.. code-block:: default


    deltas = backend.log(backend.asarray(kernel_weights.T))

    model_1 = WeightedKernelRidge(alpha=1, deltas=deltas, kernels="precomputed")
    pipe_1 = make_pipeline(column_kernelizer, model_1)

    # Fit the model on all targets
    pipe_1.fit(X_train, Y_train)






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <style>#sk-61c2caee-4656-4f86-b96a-152353afb960 {color: black;background-color: white;}#sk-61c2caee-4656-4f86-b96a-152353afb960 pre{padding: 0;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-toggleable {background-color: white;}#sk-61c2caee-4656-4f86-b96a-152353afb960 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-61c2caee-4656-4f86-b96a-152353afb960 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-61c2caee-4656-4f86-b96a-152353afb960 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-61c2caee-4656-4f86-b96a-152353afb960 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-61c2caee-4656-4f86-b96a-152353afb960 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-61c2caee-4656-4f86-b96a-152353afb960 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-estimator:hover {background-color: #d4ebff;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-item {z-index: 1;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-parallel-item:only-child::after {width: 0;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-61c2caee-4656-4f86-b96a-152353afb960 div.sk-text-repr-fallback {display: none;}</style><div id="sk-61c2caee-4656-4f86-b96a-152353afb960" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columnkernelizer&#x27;,
                     ColumnKernelizer(transformers=[(&#x27;space 0&#x27;, Kernelizer(),
                                                     slice(0, 1000, None)),
                                                    (&#x27;space 1&#x27;, Kernelizer(),
                                                     slice(1000, 2000, None)),
                                                    (&#x27;space 2&#x27;, Kernelizer(),
                                                     slice(2000, 3000, None)),
                                                    (&#x27;space 3&#x27;, Kernelizer(),
                                                     slice(3000, 4000, None))])),
                    (&#x27;weightedkernelridge&#x27;,
                     WeightedKernelRidge(alpha=1,
                                         deltas=tensor([[ -2.3483,  -1.5064,  -2.1911,  ...,  -0.5428,  -1.9162,  -4.4647],
            [ -0.1063, -12.7539,  -1.0228,  ...,  -1.0741,  -0.7493, -11.5341],
            [ -5.2674,  -0.2560,  -2.3263,  ...,  -6.4705,  -5.0901,  -0.0359],
            [ -8.5610,  -5.4922,  -0.8417,  ...,  -2.5803,  -0.9836,  -3.7396]],
           device=&#x27;cuda:0&#x27;, dtype=torch.float64),
                                         kernels=&#x27;precomputed&#x27;))])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="318d1b82-2802-4e46-acdf-f4e0f2f4f38e" type="checkbox" ><label for="318d1b82-2802-4e46-acdf-f4e0f2f4f38e" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;columnkernelizer&#x27;,
                     ColumnKernelizer(transformers=[(&#x27;space 0&#x27;, Kernelizer(),
                                                     slice(0, 1000, None)),
                                                    (&#x27;space 1&#x27;, Kernelizer(),
                                                     slice(1000, 2000, None)),
                                                    (&#x27;space 2&#x27;, Kernelizer(),
                                                     slice(2000, 3000, None)),
                                                    (&#x27;space 3&#x27;, Kernelizer(),
                                                     slice(3000, 4000, None))])),
                    (&#x27;weightedkernelridge&#x27;,
                     WeightedKernelRidge(alpha=1,
                                         deltas=tensor([[ -2.3483,  -1.5064,  -2.1911,  ...,  -0.5428,  -1.9162,  -4.4647],
            [ -0.1063, -12.7539,  -1.0228,  ...,  -1.0741,  -0.7493, -11.5341],
            [ -5.2674,  -0.2560,  -2.3263,  ...,  -6.4705,  -5.0901,  -0.0359],
            [ -8.5610,  -5.4922,  -0.8417,  ...,  -2.5803,  -0.9836,  -3.7396]],
           device=&#x27;cuda:0&#x27;, dtype=torch.float64),
                                         kernels=&#x27;precomputed&#x27;))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="899693a3-586f-4eb7-822b-bc6462dfffd8" type="checkbox" ><label for="899693a3-586f-4eb7-822b-bc6462dfffd8" class="sk-toggleable__label sk-toggleable__label-arrow">columnkernelizer: ColumnKernelizer</label><div class="sk-toggleable__content"><pre>ColumnKernelizer(transformers=[(&#x27;space 0&#x27;, Kernelizer(), slice(0, 1000, None)),
                                   (&#x27;space 1&#x27;, Kernelizer(),
                                    slice(1000, 2000, None)),
                                   (&#x27;space 2&#x27;, Kernelizer(),
                                    slice(2000, 3000, None)),
                                   (&#x27;space 3&#x27;, Kernelizer(),
                                    slice(3000, 4000, None))])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2d68447a-95e0-4055-a1a4-f6b7699e36a4" type="checkbox" ><label for="2d68447a-95e0-4055-a1a4-f6b7699e36a4" class="sk-toggleable__label sk-toggleable__label-arrow">space 0</label><div class="sk-toggleable__content"><pre>slice(0, 1000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="148b02cc-f543-4f8a-aece-8840ae780dc9" type="checkbox" ><label for="148b02cc-f543-4f8a-aece-8840ae780dc9" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="769662a5-d647-4220-9427-6079e2341f91" type="checkbox" ><label for="769662a5-d647-4220-9427-6079e2341f91" class="sk-toggleable__label sk-toggleable__label-arrow">space 1</label><div class="sk-toggleable__content"><pre>slice(1000, 2000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2a8fb571-19d0-4a6d-9986-03ffe32c6f93" type="checkbox" ><label for="2a8fb571-19d0-4a6d-9986-03ffe32c6f93" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b57e7070-3993-4e45-82e7-6b131a3e4d2e" type="checkbox" ><label for="b57e7070-3993-4e45-82e7-6b131a3e4d2e" class="sk-toggleable__label sk-toggleable__label-arrow">space 2</label><div class="sk-toggleable__content"><pre>slice(2000, 3000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7107624c-425d-4255-b3e1-2dc26e3dc399" type="checkbox" ><label for="7107624c-425d-4255-b3e1-2dc26e3dc399" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6b8d9c3e-ab34-4176-8d5e-c167308046d3" type="checkbox" ><label for="6b8d9c3e-ab34-4176-8d5e-c167308046d3" class="sk-toggleable__label sk-toggleable__label-arrow">space 3</label><div class="sk-toggleable__content"><pre>slice(3000, 4000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0f4e1c1a-4edf-4044-99c7-2d14e8f1256c" type="checkbox" ><label for="0f4e1c1a-4edf-4044-99c7-2d14e8f1256c" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="749a22f3-9ae0-46d8-bf2b-e2c128b568d0" type="checkbox" ><label for="749a22f3-9ae0-46d8-bf2b-e2c128b568d0" class="sk-toggleable__label sk-toggleable__label-arrow">WeightedKernelRidge</label><div class="sk-toggleable__content"><pre>WeightedKernelRidge(alpha=1,
                        deltas=tensor([[ -2.3483,  -1.5064,  -2.1911,  ...,  -0.5428,  -1.9162,  -4.4647],
            [ -0.1063, -12.7539,  -1.0228,  ...,  -1.0741,  -0.7493, -11.5341],
            [ -5.2674,  -0.2560,  -2.3263,  ...,  -6.4705,  -5.0901,  -0.0359],
            [ -8.5610,  -5.4922,  -0.8417,  ...,  -2.5803,  -0.9836,  -3.7396]],
           device=&#x27;cuda:0&#x27;, dtype=torch.float64),
                        kernels=&#x27;precomputed&#x27;)</pre></div></div></div></div></div></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 86-87

compute test score

.. GENERATED FROM PYTHON SOURCE LINES 87-90

.. code-block:: default

    test_scores_1 = pipe_1.score(X_test, Y_test)
    test_scores_1 = backend.to_numpy(test_scores_1)








.. GENERATED FROM PYTHON SOURCE LINES 91-93

We can compare this model to a baseline model where the kernel weights are
all equal and not learnt.

.. GENERATED FROM PYTHON SOURCE LINES 93-100

.. code-block:: default


    model_2 = WeightedKernelRidge(alpha=1, deltas="zeros", kernels="precomputed")
    pipe_2 = make_pipeline(column_kernelizer, model_2)

    # Fit the model on all targets
    pipe_2.fit(X_train, Y_train)






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <style>#sk-7cfaf187-7abd-4364-9798-15758d9d8288 {color: black;background-color: white;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 pre{padding: 0;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-toggleable {background-color: white;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-estimator:hover {background-color: #d4ebff;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-item {z-index: 1;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-parallel-item:only-child::after {width: 0;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-7cfaf187-7abd-4364-9798-15758d9d8288 div.sk-text-repr-fallback {display: none;}</style><div id="sk-7cfaf187-7abd-4364-9798-15758d9d8288" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columnkernelizer&#x27;,
                     ColumnKernelizer(transformers=[(&#x27;space 0&#x27;, Kernelizer(),
                                                     slice(0, 1000, None)),
                                                    (&#x27;space 1&#x27;, Kernelizer(),
                                                     slice(1000, 2000, None)),
                                                    (&#x27;space 2&#x27;, Kernelizer(),
                                                     slice(2000, 3000, None)),
                                                    (&#x27;space 3&#x27;, Kernelizer(),
                                                     slice(3000, 4000, None))])),
                    (&#x27;weightedkernelridge&#x27;,
                     WeightedKernelRidge(alpha=1, kernels=&#x27;precomputed&#x27;))])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="06e9a9a0-cd42-447d-b3ac-5e9590a2b798" type="checkbox" ><label for="06e9a9a0-cd42-447d-b3ac-5e9590a2b798" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;columnkernelizer&#x27;,
                     ColumnKernelizer(transformers=[(&#x27;space 0&#x27;, Kernelizer(),
                                                     slice(0, 1000, None)),
                                                    (&#x27;space 1&#x27;, Kernelizer(),
                                                     slice(1000, 2000, None)),
                                                    (&#x27;space 2&#x27;, Kernelizer(),
                                                     slice(2000, 3000, None)),
                                                    (&#x27;space 3&#x27;, Kernelizer(),
                                                     slice(3000, 4000, None))])),
                    (&#x27;weightedkernelridge&#x27;,
                     WeightedKernelRidge(alpha=1, kernels=&#x27;precomputed&#x27;))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f29c15e9-ffc5-49d6-b467-a77d8bb5d059" type="checkbox" ><label for="f29c15e9-ffc5-49d6-b467-a77d8bb5d059" class="sk-toggleable__label sk-toggleable__label-arrow">columnkernelizer: ColumnKernelizer</label><div class="sk-toggleable__content"><pre>ColumnKernelizer(transformers=[(&#x27;space 0&#x27;, Kernelizer(), slice(0, 1000, None)),
                                   (&#x27;space 1&#x27;, Kernelizer(),
                                    slice(1000, 2000, None)),
                                   (&#x27;space 2&#x27;, Kernelizer(),
                                    slice(2000, 3000, None)),
                                   (&#x27;space 3&#x27;, Kernelizer(),
                                    slice(3000, 4000, None))])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d0069ea2-13e6-4be7-b2f1-186967b61c1b" type="checkbox" ><label for="d0069ea2-13e6-4be7-b2f1-186967b61c1b" class="sk-toggleable__label sk-toggleable__label-arrow">space 0</label><div class="sk-toggleable__content"><pre>slice(0, 1000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8e294a25-3401-4289-a459-7084a83d46ee" type="checkbox" ><label for="8e294a25-3401-4289-a459-7084a83d46ee" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="3cbe1d25-9ec0-4220-9c7d-f8436c60aa59" type="checkbox" ><label for="3cbe1d25-9ec0-4220-9c7d-f8436c60aa59" class="sk-toggleable__label sk-toggleable__label-arrow">space 1</label><div class="sk-toggleable__content"><pre>slice(1000, 2000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="60ea64dd-1c3b-49e2-a4eb-f930ee676e32" type="checkbox" ><label for="60ea64dd-1c3b-49e2-a4eb-f930ee676e32" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c1dd0064-2b76-4bc9-a9e3-055bb560ba82" type="checkbox" ><label for="c1dd0064-2b76-4bc9-a9e3-055bb560ba82" class="sk-toggleable__label sk-toggleable__label-arrow">space 2</label><div class="sk-toggleable__content"><pre>slice(2000, 3000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5fb541c2-3d60-4fd4-ac43-27df3308c03b" type="checkbox" ><label for="5fb541c2-3d60-4fd4-ac43-27df3308c03b" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="24c16411-20e7-4489-8a43-33064a74cf1b" type="checkbox" ><label for="24c16411-20e7-4489-8a43-33064a74cf1b" class="sk-toggleable__label sk-toggleable__label-arrow">space 3</label><div class="sk-toggleable__content"><pre>slice(3000, 4000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="339e575c-ac85-43a1-87a9-ef54513fa72a" type="checkbox" ><label for="339e575c-ac85-43a1-87a9-ef54513fa72a" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d4c0c270-8948-4953-807b-0bff266b6773" type="checkbox" ><label for="d4c0c270-8948-4953-807b-0bff266b6773" class="sk-toggleable__label sk-toggleable__label-arrow">WeightedKernelRidge</label><div class="sk-toggleable__content"><pre>WeightedKernelRidge(alpha=1, kernels=&#x27;precomputed&#x27;)</pre></div></div></div></div></div></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 101-102

compute test score

.. GENERATED FROM PYTHON SOURCE LINES 102-105

.. code-block:: default

    test_scores_2 = pipe_2.score(X_test, Y_test)
    test_scores_2 = backend.to_numpy(test_scores_2)








.. GENERATED FROM PYTHON SOURCE LINES 106-108

Compare the predictions on a test set
-------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 108-120

.. code-block:: default

    import matplotlib.pyplot as plt

    plt.figure(figsize=(4, 3))
    plt.hist(test_scores_2, np.linspace(0, 1, 30), alpha=0.7,
             label="Default deltas")
    plt.hist(test_scores_1, np.linspace(0, 1, 30), alpha=0.7,
             label="Ground truth deltas")
    plt.xlabel("$R^2$ generalization score")
    plt.ylabel("Number of voxels")
    plt.legend()
    plt.tight_layout()
    plt.show()



.. image:: /_auto_examples/multiple_kernel_ridge/images/sphx_glr_plot_mkr_4_refit_from_deltas_001.png
    :alt: plot mkr 4 refit from deltas
    :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  0.392 seconds)


.. _sphx_glr_download__auto_examples_multiple_kernel_ridge_plot_mkr_4_refit_from_deltas.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_mkr_4_refit_from_deltas.py <plot_mkr_4_refit_from_deltas.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_mkr_4_refit_from_deltas.ipynb <plot_mkr_4_refit_from_deltas.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
