
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "_auto_examples/multiple_kernel_ridge/plot_mkr_4_refit_from_deltas.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download__auto_examples_multiple_kernel_ridge_plot_mkr_4_refit_from_deltas.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr__auto_examples_multiple_kernel_ridge_plot_mkr_4_refit_from_deltas.py:


Multiple-kernel ridge fit from fixed hyper-parameters
=====================================================
This example demonstrates how to fit a multiple-kernel ridge model with fixed
hyper-parameters. Here are three different usecases:

- If the kernel weights hyper-parameters are known and identical across
  targets, the kernels can be scaled and summed, and a simple KernelRidgeCV can
  be used to fit the model.
- If the kernel weights hyper-parameters are unknown and different across
  targets, a MultipleKernelRidgeCV can be use to search the best
  hyper-parameters per target.
- If the kernel weights hyper-parameters are known and different across
  targets, a WeightedKernelRidge model can be used to fit the ridge models on
  each target independently.

This method can be used for example in the following workflow:

- fit a MultipleKernelRidgeCV to learn the kernel weights hyper-parameter,
- save the hyper-parameters, but not the ridge weights to save disk space,
- fit a WeightedKernelRidge from the saved hyper-parameters, for further use of
  the model (prediction, interpretation, etc.).

.. GENERATED FROM PYTHON SOURCE LINES 24-36

.. code-block:: default

    import numpy as np

    from himalaya.backend import set_backend
    from himalaya.kernel_ridge import WeightedKernelRidge
    from himalaya.kernel_ridge import Kernelizer
    from himalaya.kernel_ridge import ColumnKernelizer
    from himalaya.utils import generate_multikernel_dataset

    from sklearn.pipeline import make_pipeline
    from sklearn import set_config
    set_config(display='diagram')








.. GENERATED FROM PYTHON SOURCE LINES 37-38

In this example, we use the ``torch_cuda`` backend (GPU).

.. GENERATED FROM PYTHON SOURCE LINES 38-41

.. code-block:: default


    backend = set_backend("torch_cuda", on_error="warn")








.. GENERATED FROM PYTHON SOURCE LINES 42-48

Generate a random dataset
-------------------------
- X_train : array of shape (n_samples_train, n_features)
- X_test : array of shape (n_samples_test, n_features)
- Y_train : array of shape (n_samples_train, n_targets)
- Y_test : array of shape (n_samples_test, n_targets)

.. GENERATED FROM PYTHON SOURCE LINES 48-55

.. code-block:: default


    (X_train, X_test, Y_train, Y_test, kernel_weights,
     n_features_list) = generate_multikernel_dataset(n_kernels=4, n_targets=500,
                                                     n_samples_train=1000,
                                                     n_samples_test=400,
                                                     random_state=42)








.. GENERATED FROM PYTHON SOURCE LINES 56-58

Prepare the pipeline
--------------------

.. GENERATED FROM PYTHON SOURCE LINES 58-71

.. code-block:: default


    # Find the start and end of each feature space X in Xs
    start_and_end = np.concatenate([[0], np.cumsum(n_features_list)])
    slices = [
        slice(start, end)
        for start, end in zip(start_and_end[:-1], start_and_end[1:])
    ]

    # Create a different ``Kernelizer`` for each feature space.
    kernelizers = [("space %d" % ii, Kernelizer(), slice_)
                   for ii, slice_ in enumerate(slices)]
    column_kernelizer = ColumnKernelizer(kernelizers)








.. GENERATED FROM PYTHON SOURCE LINES 72-76

Define the weighted kernel ridge model
--------------------------------------
Here we use the ground truth kernel weights for each target (deltas), but it
can be typically used with deltas obtained from a MultipleKernelRidgeCV fit.

.. GENERATED FROM PYTHON SOURCE LINES 76-85

.. code-block:: default


    deltas = backend.log(backend.asarray(kernel_weights.T))

    model_1 = WeightedKernelRidge(alpha=1, deltas=deltas, kernels="precomputed")
    pipe_1 = make_pipeline(column_kernelizer, model_1)

    # Fit the model on all targets
    pipe_1.fit(X_train, Y_train)






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <style>#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 {color: black;background-color: white;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 pre{padding: 0;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-toggleable {background-color: white;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-item {z-index: 1;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-parallel-item:only-child::after {width: 0;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-70c0e85e-de46-4b04-84db-eeccb1d371c3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-70c0e85e-de46-4b04-84db-eeccb1d371c3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columnkernelizer&#x27;,
                     ColumnKernelizer(transformers=[(&#x27;space 0&#x27;, Kernelizer(),
                                                     slice(0, 1000, None)),
                                                    (&#x27;space 1&#x27;, Kernelizer(),
                                                     slice(1000, 2000, None)),
                                                    (&#x27;space 2&#x27;, Kernelizer(),
                                                     slice(2000, 3000, None)),
                                                    (&#x27;space 3&#x27;, Kernelizer(),
                                                     slice(3000, 4000, None))])),
                    (&#x27;weightedkernelridge&#x27;,
                     WeightedKernelRidge(alpha=1,
                                         deltas=tensor([[ -2.3483,  -1.5064,  -2.1911,  ...,  -0.5428,  -1.9162,  -4.4647],
            [ -0.1063, -12.7539,  -1.0228,  ...,  -1.0741,  -0.7493, -11.5341],
            [ -5.2674,  -0.2560,  -2.3263,  ...,  -6.4705,  -5.0901,  -0.0359],
            [ -8.5610,  -5.4922,  -0.8417,  ...,  -2.5803,  -0.9836,  -3.7396]],
           device=&#x27;cuda:0&#x27;, dtype=torch.float64),
                                         kernels=&#x27;precomputed&#x27;))])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="343aec60-d205-4170-85fc-5ac3be061bf5" type="checkbox" ><label for="343aec60-d205-4170-85fc-5ac3be061bf5" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;columnkernelizer&#x27;,
                     ColumnKernelizer(transformers=[(&#x27;space 0&#x27;, Kernelizer(),
                                                     slice(0, 1000, None)),
                                                    (&#x27;space 1&#x27;, Kernelizer(),
                                                     slice(1000, 2000, None)),
                                                    (&#x27;space 2&#x27;, Kernelizer(),
                                                     slice(2000, 3000, None)),
                                                    (&#x27;space 3&#x27;, Kernelizer(),
                                                     slice(3000, 4000, None))])),
                    (&#x27;weightedkernelridge&#x27;,
                     WeightedKernelRidge(alpha=1,
                                         deltas=tensor([[ -2.3483,  -1.5064,  -2.1911,  ...,  -0.5428,  -1.9162,  -4.4647],
            [ -0.1063, -12.7539,  -1.0228,  ...,  -1.0741,  -0.7493, -11.5341],
            [ -5.2674,  -0.2560,  -2.3263,  ...,  -6.4705,  -5.0901,  -0.0359],
            [ -8.5610,  -5.4922,  -0.8417,  ...,  -2.5803,  -0.9836,  -3.7396]],
           device=&#x27;cuda:0&#x27;, dtype=torch.float64),
                                         kernels=&#x27;precomputed&#x27;))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="1271fcec-7c21-4cd6-8875-d4293b33e364" type="checkbox" ><label for="1271fcec-7c21-4cd6-8875-d4293b33e364" class="sk-toggleable__label sk-toggleable__label-arrow">columnkernelizer: ColumnKernelizer</label><div class="sk-toggleable__content"><pre>ColumnKernelizer(transformers=[(&#x27;space 0&#x27;, Kernelizer(), slice(0, 1000, None)),
                                   (&#x27;space 1&#x27;, Kernelizer(),
                                    slice(1000, 2000, None)),
                                   (&#x27;space 2&#x27;, Kernelizer(),
                                    slice(2000, 3000, None)),
                                   (&#x27;space 3&#x27;, Kernelizer(),
                                    slice(3000, 4000, None))])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5622a6f5-c18a-45d1-9161-0093dbcf90a5" type="checkbox" ><label for="5622a6f5-c18a-45d1-9161-0093dbcf90a5" class="sk-toggleable__label sk-toggleable__label-arrow">space 0</label><div class="sk-toggleable__content"><pre>slice(0, 1000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="45065835-347b-48b3-a859-e3d9d32eb349" type="checkbox" ><label for="45065835-347b-48b3-a859-e3d9d32eb349" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="02119b9b-161e-44a4-a2ff-afb9087985cc" type="checkbox" ><label for="02119b9b-161e-44a4-a2ff-afb9087985cc" class="sk-toggleable__label sk-toggleable__label-arrow">space 1</label><div class="sk-toggleable__content"><pre>slice(1000, 2000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6e4d7c16-98ba-469b-a581-0bf5459624b2" type="checkbox" ><label for="6e4d7c16-98ba-469b-a581-0bf5459624b2" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="defcfc02-1bea-4886-9f04-601a0fb3ded9" type="checkbox" ><label for="defcfc02-1bea-4886-9f04-601a0fb3ded9" class="sk-toggleable__label sk-toggleable__label-arrow">space 2</label><div class="sk-toggleable__content"><pre>slice(2000, 3000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b60dbb71-7240-48e0-b33f-a0802a5048a6" type="checkbox" ><label for="b60dbb71-7240-48e0-b33f-a0802a5048a6" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="19e6d3ed-2f09-40ef-9247-8371f9876b84" type="checkbox" ><label for="19e6d3ed-2f09-40ef-9247-8371f9876b84" class="sk-toggleable__label sk-toggleable__label-arrow">space 3</label><div class="sk-toggleable__content"><pre>slice(3000, 4000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6482d02f-7c70-467a-ae06-f0adf5522c25" type="checkbox" ><label for="6482d02f-7c70-467a-ae06-f0adf5522c25" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a82fdcfb-2de7-449e-bcf7-4daaa41ff0f4" type="checkbox" ><label for="a82fdcfb-2de7-449e-bcf7-4daaa41ff0f4" class="sk-toggleable__label sk-toggleable__label-arrow">WeightedKernelRidge</label><div class="sk-toggleable__content"><pre>WeightedKernelRidge(alpha=1,
                        deltas=tensor([[ -2.3483,  -1.5064,  -2.1911,  ...,  -0.5428,  -1.9162,  -4.4647],
            [ -0.1063, -12.7539,  -1.0228,  ...,  -1.0741,  -0.7493, -11.5341],
            [ -5.2674,  -0.2560,  -2.3263,  ...,  -6.4705,  -5.0901,  -0.0359],
            [ -8.5610,  -5.4922,  -0.8417,  ...,  -2.5803,  -0.9836,  -3.7396]],
           device=&#x27;cuda:0&#x27;, dtype=torch.float64),
                        kernels=&#x27;precomputed&#x27;)</pre></div></div></div></div></div></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 86-87

compute test score

.. GENERATED FROM PYTHON SOURCE LINES 87-90

.. code-block:: default

    test_scores_1 = pipe_1.score(X_test, Y_test)
    test_scores_1 = backend.to_numpy(test_scores_1)








.. GENERATED FROM PYTHON SOURCE LINES 91-93

We can compare this model to a baseline model where the kernel weights are
all equal and not learnt.

.. GENERATED FROM PYTHON SOURCE LINES 93-100

.. code-block:: default


    model_2 = WeightedKernelRidge(alpha=1, deltas="zeros", kernels="precomputed")
    pipe_2 = make_pipeline(column_kernelizer, model_2)

    # Fit the model on all targets
    pipe_2.fit(X_train, Y_train)






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <style>#sk-87aba9e0-bb0d-4984-9767-465c470cb55e {color: black;background-color: white;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e pre{padding: 0;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-toggleable {background-color: white;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-estimator:hover {background-color: #d4ebff;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-item {z-index: 1;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-parallel-item:only-child::after {width: 0;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-87aba9e0-bb0d-4984-9767-465c470cb55e div.sk-text-repr-fallback {display: none;}</style><div id="sk-87aba9e0-bb0d-4984-9767-465c470cb55e" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columnkernelizer&#x27;,
                     ColumnKernelizer(transformers=[(&#x27;space 0&#x27;, Kernelizer(),
                                                     slice(0, 1000, None)),
                                                    (&#x27;space 1&#x27;, Kernelizer(),
                                                     slice(1000, 2000, None)),
                                                    (&#x27;space 2&#x27;, Kernelizer(),
                                                     slice(2000, 3000, None)),
                                                    (&#x27;space 3&#x27;, Kernelizer(),
                                                     slice(3000, 4000, None))])),
                    (&#x27;weightedkernelridge&#x27;,
                     WeightedKernelRidge(alpha=1, kernels=&#x27;precomputed&#x27;))])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8f2279e4-0041-42c0-8489-d2756901c8f5" type="checkbox" ><label for="8f2279e4-0041-42c0-8489-d2756901c8f5" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;columnkernelizer&#x27;,
                     ColumnKernelizer(transformers=[(&#x27;space 0&#x27;, Kernelizer(),
                                                     slice(0, 1000, None)),
                                                    (&#x27;space 1&#x27;, Kernelizer(),
                                                     slice(1000, 2000, None)),
                                                    (&#x27;space 2&#x27;, Kernelizer(),
                                                     slice(2000, 3000, None)),
                                                    (&#x27;space 3&#x27;, Kernelizer(),
                                                     slice(3000, 4000, None))])),
                    (&#x27;weightedkernelridge&#x27;,
                     WeightedKernelRidge(alpha=1, kernels=&#x27;precomputed&#x27;))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="318c4234-03f1-451d-a969-39b2b58421ab" type="checkbox" ><label for="318c4234-03f1-451d-a969-39b2b58421ab" class="sk-toggleable__label sk-toggleable__label-arrow">columnkernelizer: ColumnKernelizer</label><div class="sk-toggleable__content"><pre>ColumnKernelizer(transformers=[(&#x27;space 0&#x27;, Kernelizer(), slice(0, 1000, None)),
                                   (&#x27;space 1&#x27;, Kernelizer(),
                                    slice(1000, 2000, None)),
                                   (&#x27;space 2&#x27;, Kernelizer(),
                                    slice(2000, 3000, None)),
                                   (&#x27;space 3&#x27;, Kernelizer(),
                                    slice(3000, 4000, None))])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4f68454a-2c26-49eb-b513-6ad4916622fa" type="checkbox" ><label for="4f68454a-2c26-49eb-b513-6ad4916622fa" class="sk-toggleable__label sk-toggleable__label-arrow">space 0</label><div class="sk-toggleable__content"><pre>slice(0, 1000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c1acf2b6-d8c7-4fc2-ab2b-b209c15827d9" type="checkbox" ><label for="c1acf2b6-d8c7-4fc2-ab2b-b209c15827d9" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d1bdf4cb-d743-4535-ae38-dea3c1ddad19" type="checkbox" ><label for="d1bdf4cb-d743-4535-ae38-dea3c1ddad19" class="sk-toggleable__label sk-toggleable__label-arrow">space 1</label><div class="sk-toggleable__content"><pre>slice(1000, 2000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6363d4c0-6b4a-4c65-b960-dab3991b3f58" type="checkbox" ><label for="6363d4c0-6b4a-4c65-b960-dab3991b3f58" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d0c852b1-425a-4070-9185-4542b791bf48" type="checkbox" ><label for="d0c852b1-425a-4070-9185-4542b791bf48" class="sk-toggleable__label sk-toggleable__label-arrow">space 2</label><div class="sk-toggleable__content"><pre>slice(2000, 3000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ab0dd40f-a2c6-4b0f-9e61-8e3bb40b0c80" type="checkbox" ><label for="ab0dd40f-a2c6-4b0f-9e61-8e3bb40b0c80" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f92c2acd-3e63-4dd3-9a05-c95c678c93ab" type="checkbox" ><label for="f92c2acd-3e63-4dd3-9a05-c95c678c93ab" class="sk-toggleable__label sk-toggleable__label-arrow">space 3</label><div class="sk-toggleable__content"><pre>slice(3000, 4000, None)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a0b4793a-7b80-4eee-9713-22984bb861b0" type="checkbox" ><label for="a0b4793a-7b80-4eee-9713-22984bb861b0" class="sk-toggleable__label sk-toggleable__label-arrow">Kernelizer</label><div class="sk-toggleable__content"><pre>Kernelizer()</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c52a3117-32db-44d1-a5cc-cacae262c817" type="checkbox" ><label for="c52a3117-32db-44d1-a5cc-cacae262c817" class="sk-toggleable__label sk-toggleable__label-arrow">WeightedKernelRidge</label><div class="sk-toggleable__content"><pre>WeightedKernelRidge(alpha=1, kernels=&#x27;precomputed&#x27;)</pre></div></div></div></div></div></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 101-102

compute test score

.. GENERATED FROM PYTHON SOURCE LINES 102-105

.. code-block:: default

    test_scores_2 = pipe_2.score(X_test, Y_test)
    test_scores_2 = backend.to_numpy(test_scores_2)








.. GENERATED FROM PYTHON SOURCE LINES 106-108

Compare the predictions on a test set
-------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 108-120

.. code-block:: default

    import matplotlib.pyplot as plt

    plt.figure(figsize=(4, 3))
    plt.hist(test_scores_2, np.linspace(0, 1, 30), alpha=0.7,
             label="Default deltas")
    plt.hist(test_scores_1, np.linspace(0, 1, 30), alpha=0.7,
             label="Ground truth deltas")
    plt.xlabel("$R^2$ generalization score")
    plt.ylabel("Number of voxels")
    plt.legend()
    plt.tight_layout()
    plt.show()



.. image:: /_auto_examples/multiple_kernel_ridge/images/sphx_glr_plot_mkr_4_refit_from_deltas_001.png
    :alt: plot mkr 4 refit from deltas
    :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  0.391 seconds)


.. _sphx_glr_download__auto_examples_multiple_kernel_ridge_plot_mkr_4_refit_from_deltas.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_mkr_4_refit_from_deltas.py <plot_mkr_4_refit_from_deltas.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_mkr_4_refit_from_deltas.ipynb <plot_mkr_4_refit_from_deltas.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
