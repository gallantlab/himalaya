language: python

python:
  - "3.6"
  - "3.7"
  - "3.8"
  - "3.9"

cache:
  - pip

before_install:
  - python -m pip install --upgrade pip

install:
  - pip install -e ."[travis]"
  - python -c 'import himalaya; print(himalaya.__version__)'

script:
  # install necessary packages to run tests and get coverage
  - travis_retry pip install -q -U pytest pytest-cov codecov
  - pytest --cov=./
  # install packages for docs and make docs
  # - travis_retry pip install -q ipython Sphinx sphinx-gallery numpydoc
  # - cd doc && make html && cd ..
  # Tell GitHub not to use jekyll to compile the docs
  # - touch doc/_build/html/.nojekyll

after_success:
  - codecov

deploy:
#   - provider: pages
#     skip_cleanup: true
#     github_token: $GITHUB_TOKEN  # Set in travis-ci.org dashboard, marked secure
#     keep-history: true
#     on:
#       branch: main
#       tags: true
#       # push only once
#       python: "3.9"
#     local_dir: doc/_build/html/
#
   - provider: pypi
     user: "__token__"
     password: $PIPY_TOKEN
     on:
       distributions: sdist
       tags: true
       branch: main
       repo: gallantlab/himalaya
       python: "3.9"
